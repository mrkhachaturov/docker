services:
  obsidian:
    image: linuxserver/obsidian:1.9.12@sha256:36e9cd35adb5f7e10e017364e5dbbe42a7c2086e0dcda1446ac44c51f2834bfa
    container_name: obsidian
    restart: unless-stopped
    security_opt:
      - no-new-privileges:false
      - seccomp:unconfined
    profiles: ["apps", "all"]
    networks:
      - trf_int
    volumes:
      - $DOCKERDIR/appdata/obsidian/config:/config:rw
      # - $DOCKERDIR/appdata/obsidian/data:/data
    environment: 
      - TZ=$TZ
      - PUID=$PUID
      - PGID=$PGID
      - DOCKER_MODS=linuxserver/mods:universal-package-install
      - INSTALL_PACKAGES=iputils-ping|net-tools|curl|wget|vim|dnsutils
    shm_size: "5gb"
    # devices:
    #   - /dev/dri:/dev/dri #optional
    labels:
      - "traefik.enable=true"
      - "traefik.group=internal"
      # HTTP Routers
      - "traefik.http.routers.obsidian-rtr.entrypoints=websecure"
      - "traefik.http.routers.obsidian-rtr.rule=Host(`notes.$DOMAINNAME_HL`)"
      - "traefik.http.routers.obsidian-api-rtr.entrypoints=websecure"
      - "traefik.http.routers.obsidian-api-rtr.rule=Host(`obsidian-api.$DOMAINNAME_HL`)"
      #- "traefik.http.routers.portainer-rtr.tls.certresolver=zerossl"
      # Middlewares
      #- "traefik.http.routers.portainer-rtr.middlewares=chain-oauth@file"
      # HTTP Services
      - "traefik.http.routers.obsidian-rtr.service=obsidian-svc"
      - "traefik.http.services.obsidian-svc.loadbalancer.server.port=3000"
      - "traefik.http.routers.obsidian-api-rtr.service=obsidian-api-svc"
      - "traefik.http.services.obsidian-api-svc.loadbalancer.server.port=3023"
      - "traefik.docker.network=trf_int"      